function rescale(t,e,n,a,o){return a||(a=0),o||(o=1),(n-e)*(t-a)/(o-a)+e}function interleave(t,e){if(t.length!=e.length)throw"inputs must have the same length";C=new Array(2*t.length);for(let n=0;n<t.length;n++)C[2*n]=t[n],C[2*n+1]=e[n];return C}$(document).ready((()=>{const t=window.location.search,e=new URLSearchParams(t),n=parseInt(e.get("n")),a=parseFloat(e.get("nu")),o=e.get("version");let r=500;n&&(r=n);let l=4;a&&(l=a);let s="leading geodesic";"I"==o&&(s="leading straight cone",$("#modeltoggle-cb").prop("checked",!1));let i=Math.sqrt(r)/2,g=[-i,-i,i,i],c=new VTPState(r,1,l,s),d=1;c.randomize(g),c.addTargetComponent([0,0]);const h=document.getElementById("canvas");let m,u;function p(){m||(m=setInterval((()=>{c.render(h,g.map((t=>t*d)))}),40))}function T(){u||(u=setInterval((()=>{c.step(),$("#treadout").html(c.iteration)}),40))}function f(){clearInterval(u),u=null}p();const k=$("#playbutton-cb");k.change((()=>{k.prop("checked")?(T(),running=!0):(f(),running=!1)})),$("#skipbutton").on("click",(()=>{running&&f(),clearInterval(m),m=null;for(let t=0;t<100;t++)c.step();$("#treadout").html(c.iteration),p(),running&&T()})),$("#zoomin").on("click",(()=>d/=1.1)),$("#zoomout").on("click",(()=>d*=1.1));const C=$("#modeltoggle-cb");C.change((()=>{C.prop("checked")?c.speedModel="leading geodesic":c.speedModel="leading straight cone"}));const v=$("#textField-N");v.val(c.numAgents),$("#nForm").submit((()=>{if(r=parseInt(v.val()),!isNaN(r)&&r>0){i=Math.sqrt(r)/2,g=[-i,-i,i,i];let t=c.alignmentStrength;c=new VTPState(r,1,t),c.randomize(g),c.addTargetComponent([0,0]),d=1,$("#Nreadout").html(r)}}));const M=$("#textField-nu");M.val(c.alignmentStrength),$("#alignmentStrengthForm").submit((()=>{const t=parseFloat(M.val());!isNaN(t)&&t>0&&(c.alignmentStrength=t,$("#nureadout").html(t))})),$("#target-options *").click((function(){let t=!1;u&&(f(),t=!0),c.clearTargets();switch($(this).attr("id")){case"single-point":c.addTargetComponent([0,0]);break;case"segment":c.addTargetComponent([-10,0,10,0]);break;case"cross":c.addTargetComponent([-10,-10,10,10],"+"),c.addTargetComponent([-10,10,10,-10],"-"),c.assignToTarget("+",0,Math.floor(r/2)),c.assignToTarget("-",Math.floor(r/2),r);break;case"ngon":let t=5;c.addTargetComponent(Array(2*t).fill(0).map(((e,n)=>n%2==0?5*Math.sin(n/2*2*Math.PI/t):5*Math.cos((n-1)/2*2*Math.PI/t))));break;case"nested-squares":c.addTargetComponent([-3,-3,3,-3,3,3,-3,3],"in"),c.addTargetComponent([-9,-9,9,-9,9,9,-9,9],"out"),c.assignToTarget("in",0,Math.floor(r/2)),c.assignToTarget("out",Math.floor(r/2),r)}t&&T()})),$("#export").on("click",(()=>{c.exportData()}))}));